(this["webpackJsonplush-file-uploader"]=this["webpackJsonplush-file-uploader"]||[]).push([[0],{10:function(e,t,n){},13:function(e,t,n){e.exports=n(20)},19:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n(2),o=n(4),i=n(3),c=n(5),s=n(0),l=n.n(s),u=n(11),f=n.n(u);n(8),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var p=n(6),m=n.n(p),d=n(7),h=n(12),g=(n(10),{TEST_START:0,TEST_IN_PROGRESS:1,TEST_KILL:2}),b=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,c=new Array(r),s=0;s<r;s++)c[s]=arguments[s];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(c)))).state={runTest:!1},n.sendCommand=function(e){if(e===g.TEST_START){n.props.notificationManager.current.openNotification("The test is warming up...");var t=n.props.endpoint+"/test-start";fetch(t,{method:"GET"}).then((function(){n.props.notificationManager.current.openNotification("Test is running!")})).catch((function(e){return console.log(e)})),n.setState({runTest:!0})}else if(e===g.TEST_KILL){var a=n.props.endpoint+"/test-kill";fetch(a,{method:"GET"}).then((function(){n.props.notificationManager.current.openNotification("Test cancelled")})).catch((function(e){return console.log(e)})),n.setState({runTest:!1})}},n.triggerTest=function(e){e===g.TEST_START?(console.log("Test running!"),n.sendCommand(e)):e===g.TEST_KILL&&(console.log("End of test..."),n.sendCommand(e))},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return l.a.createElement(l.a.Fragment,null,l.a.createElement("button",Object(h.a)({className:"red-button",onTouchStart:function(){return e.triggerTest(g.TEST_START)},onTouchEnd:function(){return e.triggerTest(g.TEST_KILL)},onMouseDown:function(){return e.triggerTest(g.TEST_START)},onMouseUp:function(){return e.triggerTest(g.TEST_KILL)}},"className","inputbtn"),this.state.runTest?l.a.createElement("span",null,"Release to end"):l.a.createElement("span",null,"Press + hold to test")))}}]),t}(l.a.Component),E=function(e){function t(){var e,n;Object(a.a)(this,t);for(var r=arguments.length,c=new Array(r),s=0;s<r;s++)c[s]=arguments[s];return(n=Object(o.a)(this,(e=Object(i.a)(t)).call.apply(e,[this].concat(c)))).triggerReboot=function(){var e=n.props.endpoint+"/reboot";n.props.notificationManager.current.openNotification("Reboot has been started, please wait 5 minutes"),fetch(e,{method:"GET"}).then((function(){console.log("reboot doesn't return anything, you should never be here!")})).catch((function(e){return n.props.notificationManager.current.openNotification("Reboot is still in progress")}))},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){var e=this;return l.a.createElement(l.a.Fragment,null,l.a.createElement("button",{onTouchStart:function(){return e.triggerReboot()},onTouchEnd:function(){return e.triggerReboot()},onMouseDown:function(){return e.triggerReboot()},onMouseUp:function(){return e.triggerReboot()},className:"inputbtn"},"Emergency reboot"))}}]),t}(l.a.Component),v=(n(19),function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).openNotification=function(e){n.setState({isActive:!0,message:e}),n.timer=window.setTimeout((function(){n.setState({isActive:!1,message:""})}),6e3)},n.state={timer:null,isActive:!1,message:""},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return this.state.isActive?l.a.createElement("div",{className:"notification"},l.a.createElement("div",{className:"notification-body"},this.state.message)):null}}]),t}(s.PureComponent)),T="dev"===Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_STAGE?"http://192.168.63.202:5000":window.location.origin,S=function(e){function t(e){var n;return Object(a.a)(this,t),(n=Object(o.a)(this,Object(i.a)(t).call(this,e))).notificationRef=l.a.createRef(),n.fileChangeHandler=function(e){var t=e.target.files[0];n.setState({selectedFile:t})},n.colorChangeHandler=function(e){var t=e.target.value;n.setState({selectedCol:t})},n.handleSubmit=function(e){e.preventDefault();var t=new FormData;t.append("file",n.state.selectedFile),t.append("colour",n.state.selectedCol);var a=n.uploadFile(t),r=n.uploadCol(t);a&&r?(console.log("Response from notification manager: ",a,r),n.notificationManager("Upload success")):a||r?!a&&r?n.notificationManager("Error: Failed to upload colour"):a||r||n.notificationManager("Error: Upload failed"):(console.log("Response from notification manager: ",a,r),n.notificationManager("Error: Failed to upload audio file"))},n.distanceHandlerActive=function(){n.notificationManager("Warming up the room..."),n.endpointRequest(!0).then((function(e){e?n.notificationManager("Success: Activated"):n.notificationManager("Error: Could not activate")})).catch((function(e){console.log("Something went horribly wrong...")}))},n.distanceHandlerDeactive=function(){n.notificationManager("Ending the test..."),n.endpointRequest(!1)?n.notificationManager("Success: Deactivated"):n.notificationManager("Error: Could not deactivate")},n.endpointRequest=function(){var e=Object(d.a)(m.a.mark((function e(t){var n,a,r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("epr: ",t),n="",""===(n=t?T+"/test-start":T+"/test-kill")){e.next=13;break}return e.next=6,fetch(n,{headers:{"Content-Type":"application/json"}});case 6:return a=e.sent,e.next=9,a.json();case 9:if(r=e.sent,console.log("json res: ",r),null==r||200!==r.response){e.next=13;break}return e.abrupt("return",!0);case 13:return e.abrupt("return",!1);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.uploadFile=function(){var e=Object(d.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T+"/upload-file",e.next=3,fetch(n,{method:"POST",body:t});case 3:if(null==(a=e.sent)||200!==a.response){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.uploadCol=function(){var e=Object(d.a)(m.a.mark((function e(t){var n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T+"/upload-colour",e.next=3,fetch(n,{method:"POST",body:t});case 3:if(null==(a=e.sent)||200!==a.response){e.next=6;break}return e.abrupt("return",!0);case 6:return e.abrupt("return",!1);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.state={selectedFile:null,selectedCol:"#011993",currentTrack:null,hostname:"Offline"},n}return Object(c.a)(t,e),Object(r.a)(t,[{key:"notificationManager",value:function(e){this.notificationRef.current.openNotification(e)}},{key:"componentDidMount",value:function(){var e=Object(d.a)(m.a.mark((function e(){var t,n,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=T+"/status",e.next=3,fetch(t,{headers:{"Content-Type":"application/json"}});case 3:return n=e.sent,e.next=6,n.json();case 6:200===(a=e.sent).response&&"healthy"===a.status&&a.color&&this.setState({selectedCol:a.color,currentTrack:a.track_name,hostname:a.hostname}),console.log("json res: ",a);case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"layout_header"},l.a.createElement("h1",null,this.state.hostname)),l.a.createElement("div",{className:"form_body"},l.a.createElement("form",{onSubmit:this.handleSubmit},this.state.currentTrack?l.a.createElement(l.a.Fragment,null,l.a.createElement("h4",null,"is loaded with:"),l.a.createElement("h2",{id:"track-name"},this.state.currentTrack)):l.a.createElement("h5",null,"No track found on this scentroom"),l.a.createElement("label",null,"Upload a new mp3 from your device"),l.a.createElement("br",null),l.a.createElement("input",{type:"file",id:"fileinput",name:"file",accept:".mp3",onChange:this.fileChangeHandler}),l.a.createElement("label",null,"Pick a color"),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("input",{type:"color",name:"colour",onChange:this.colorChangeHandler,value:this.state.selectedCol})," ",l.a.createElement("br",null),l.a.createElement("input",{type:"submit",value:"Upload",className:"inputbtn"})),l.a.createElement("hr",null),l.a.createElement("div",{className:"test-button"},l.a.createElement(b,{endpoint:T,notificationManager:this.notificationRef})),"or...",l.a.createElement("br",null),l.a.createElement("button",{className:"tempSensorBtn",onClick:this.distanceHandlerActive}," Start test"),l.a.createElement("button",{className:"tempSensorBtn",onClick:this.distanceHandlerDeactive}," End test"),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(v,{ref:this.notificationRef}),l.a.createElement("hr",null),l.a.createElement(E,{endpoint:T,notificationManager:this.notificationRef})))}}]),t}(l.a.Component),j=function(e){function t(){return Object(a.a)(this,t),Object(o.a)(this,Object(i.a)(t).apply(this,arguments))}return Object(c.a)(t,e),Object(r.a)(t,[{key:"render",value:function(){return l.a.createElement("div",null,l.a.createElement(S,null))}}]),t}(l.a.Component);f.a.render(l.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,n){}},[[13,1,2]]]);
//# sourceMappingURL=main.eeb48d6b.chunk.js.map